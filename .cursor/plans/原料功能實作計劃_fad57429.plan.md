---
name: 原料功能實作計劃
overview: 參考 Supplier 功能架構，建立完整的原料管理功能，包含列表顯示、新增/編輯/刪除、以及 Excel 匯入功能。
todos:
  - id: create-directory
    content: 建立 src/views/main/RawMaterial/ 目錄
    status: completed
  - id: create-index
    content: 建立 index.vue - 原料列表主頁面（包含搜尋、統計、表格顯示）
    status: completed
  - id: create-add
    content: 建立 Add.vue - 新增/編輯表單對話框（包含所有 14 個欄位）
    status: completed
  - id: create-import
    content: 建立 importRawMaterial.vue - Excel 匯入功能（讀取「原料特性表」Sheet）
    status: completed
  - id: register-route
    content: 在 router/index.js 中註冊 RawMaterial 路由
    status: completed
---

# 原料功能實作計劃

## 概述

參考 `src/views/main/Supplier` 的實作方式，建立完整的原料管理功能模組。包含列表顯示、搜尋、統計、新增、修改、刪除，以及 Excel 匯入功能。

## 目錄結構

建立 `src/views/main/RawMaterial/` 目錄，包含以下檔案：

- `index.vue` - 原料列表主頁面
- `Add.vue` - 新增/編輯表單對話框
- `importRawMaterial.vue` - Excel 匯入功能

## 資料欄位對應

### Excel 欄位映射（中文 → 英文）

根據需求文件，需要處理以下欄位：

- 項次 → `itemNumber`
- 類別 → `category`
- 原料料號 → `materialNumber` (核心欄位，用於唯一識別)
- 商品名 → `productName`
- 原料名稱 → `materialName`
- INCI NAME → `inciName`
- 中文名 → `chineseName`
- 功效 → `efficacy`
- 提供廠商 → `supplier`
- 廠牌 → `brand`
- MOQ(Kg) → `moq`
- 單價 → `unitPrice`
- CAS# → `casNumber`
- pH → `ph`

### Excel 匯入規格

- Sheet 名稱：**原料特性表**
- 資料格式：參考 Supplier 的匯入邏輯（第1-2列不使用，第3列為欄位名，第4列開始為資料）

## 實作細節

### 1. 路由註冊

在 `src/router/index.js` 的 main 路由 children 中新增：

```javascript
{ path: 'RawMaterial', name: 'RawMaterial', component: () => import('@/views/main/RawMaterial/index.vue') }
```

### 2. index.vue - 主列表頁面

參考 `src/views/main/Supplier/index.vue` 的結構：

- Hero 區塊：顯示「原料管理面板」標題
- 統計卡片：原料總數、有提供廠商的數量、有 CAS# 的數量
- 搜尋工具列：關鍵字搜尋、匯入 Excel 按鈕、新增原料按鈕
- 資料表格：顯示所有欄位，使用 PaginatedIterator 分頁
- 操作功能：編輯、刪除（透過選單或按鈕）
- 資料庫名稱：`usingDatabase = "rawMaterial"`

### 3. Add.vue - 新增/編輯表單

參考 `src/views/main/Supplier/Add.vue` 的結構：

- 表單分組：
  - 基本資料：原料料號（必填）、商品名、原料名稱、類別
  - 化學資訊：INCI NAME、中文名、CAS#、pH
  - 商業資訊：提供廠商、廠牌、MOQ(Kg)、單價
  - 其他資訊：功效、項次
- 驗證規則：原料料號必填且不可重複
- 新增/編輯模式切換
- 建立/修改紀錄追蹤

### 4. importRawMaterial.vue - Excel 匯入

參考 `src/views/main/Supplier/importSupplier.vue` 的結構：

- 檔案選擇：支援 .xlsx 和 .xls
- 資料解析：讀取「原料特性表」Sheet
- 欄位映射：將中文欄位名對應到英文欄位名
- 資料預覽：顯示前 5 筆資料預覽
- 重複檢查：檢查原料料號是否已存在
- 批次匯入：使用 `api.addMulti` 進行批次新增
- 錯誤處理：顯示匯入結果和錯誤訊息

## 技術要點

### 資料庫操作

- 使用 `api.get("rawMaterial")` 取得所有資料
- 使用 `api.add("rawMaterial", data)` 新增單筆
- 使用 `api.post("rawMaterial", data)` 更新單筆
- 使用 `api.delete("rawMaterial", data)` 刪除單筆
- 使用 `api.addMulti("rawMaterial", data)` 批次新增

### 資料結構

每筆原料資料包含：

- 所有業務欄位（如上列出的 14 個欄位），建成 JSON格式，在存 datalist 欄位
- `snkey`: 系統唯一識別碼
- materialNumber：另外將 materialNumber 另外存成一欄；加速搜尋用
- `createInfo`: { snkey, name, time } - 建立資訊
- `editInfo`: [{ snkey, name, time }, ...] - 修改歷史

### Excel 解析邏輯

- 使用 `xlsx` 套件解析 Excel
- 讀取指定 Sheet 名稱「原料特性表」
- 第 3 列（索引 2）為欄位標題
- 第 4 列開始（索引 3+）為資料內容
- 跳過空行
- 核心欄位驗證：原料料號

## 樣式設計

參考 Supplier 的樣式：

- 使用 Daycare Style 設計風格
- 漸層背景和卡片樣式
- 統一的按鈕和表單元件樣式
- 響應式設計支援

## 注意事項

1. 原料料號作為唯一識別，新增和匯入時需檢查重複
2. 數值欄位（MOQ、單價、pH）需要適當的資料型別處理
3. Excel 匯入時需處理資料格式轉換（字串、數字、布林值）
4. 刪除功能需加入確認對話框
5. 所有操作需記錄建立/修改資訊